# Config Flag Standardization Plan

## Overview

Standardize all config flag handling to use consistent input/output patterns.

## Current State Analysis

### Pattern A: Macro-Generated Boolean (Consistent)
Uses `define_bool_toggle!` macro - 21 instances
- Input: `"0"` or `"1"`
- Output: `"COMMAND: OFF"` or `"COMMAND: ON"`

### Pattern B: Manual Boolean (Inconsistent)
Custom implementations with varying output formats:
- `HL.COND` - manual 0/1 matching
- `LIMIT` - manual 0/1 matching
- `TITLE` - manual 0/1 matching

### Pattern C: Enum Selection (Consistent)
Uses `define_enum_select!` macro - 6 instances
- Input: numeric value
- Output: `"COMMAND: {num} ({label})"`

## Identified Inconsistencies

### 1. Query Output Format Variations

**Current mixed formats:**
```
METER.HDR: 1                    # Bare numeric
CPU DISPLAY: OFF                # Text only
TITLE: 0 (MONOKIT)              # Numeric + semantic
SCOPE.UNI: 0 (BIPOLAR)          # Numeric + semantic
```

**Target format (all boolean):**
```
CPU: OFF
METER.HDR: ON
TITLE: OFF (MONOKIT)
```

### 2. Manual Handlers Not Using Macros

| Command | Location | Issue |
|---------|----------|-------|
| `HL.COND` | misc.rs:811-830 | Duplicates bool logic |
| `LIMIT` | misc.rs:631-667 | Custom 0/1 handling |
| `TITLE` | misc.rs:952-1001 | Custom 0/1 handling |

## Implementation Tasks

### Task 1: Convert Manual Handlers to Macros

**File:** `src/commands/system/misc.rs`

1. Convert `HL.COND` to use `define_bool_toggle!`:
```rust
define_bool_toggle!(
    handle_hl_cond,
    "show_conditional_highlight",
    "HL.COND",
    "COND HIGHLIGHT"
);
```

2. Convert `LIMIT` to use `define_bool_toggle!`:
```rust
define_bool_toggle!(
    handle_limit,
    "limiter_enabled",
    "LIMIT",
    "LIMITER"
);
```

3. Convert `TITLE` to use `define_enum_select!` (has semantic values):
```rust
define_enum_select!(
    handle_title,
    "title_mode",
    "TITLE",
    [0 => "MONOKIT", 1 => "SCENE"]
);
```

### Task 2: Standardize Output Format

**Decision:** All boolean toggles output `COMMAND: OFF/ON`

Update `define_bool_toggle!` macro output (if needed):
```rust
// Ensure consistent format:
output.push(format!("{}: {}", $display_name, if *state { "ON" } else { "OFF" }));
```

### Task 3: Audit All Config Commands

Complete list of config commands (40 total):

**Display UI (11):** METER.HDR, METER.GRID, METER.ASCII, SPECTRUM, ACTIVITY, GRID, GRID.DEF, GRID.MODE, CPU, BPM, TITLE

**Highlighting (2):** HL.SEQ, HL.COND

**Scope (4):** SCOPE.TIME, SCOPE.CLR, SCOPE.MODE, SCOPE.UNI

**Scramble (4):** SCRMBL, SCRMBL.MODE, SCRMBL.SPD, SCRMBL.CRV

**Output (5):** DEBUG, HEADER, OUT.ERR, OUT.ESS, OUT.QRY, OUT.CFM

**Scene (4):** LOAD, LOAD.RST, LOAD.CLR, AUTOLOAD

**Audio/MIDI (3):** AUDIO.OUT, MIDI.IN, MIDI.DIAG

**Effects (1):** LIMIT

**Other (3):** THEME, TITLE.TIMER, COMPAT.MODE

### Task 4: Update Help Documentation

**File:** `src/ui/pages/help_content.rs`

Ensure all boolean flags documented as:
```
COMMAND <0|1>     DESCRIPTION (0=OFF, 1=ON)
```

Ensure all enum flags documented as:
```
COMMAND <0-N>     DESCRIPTION
                  0=LABEL0, 1=LABEL1, ...
```

## Files to Modify

| File | Changes |
|------|---------|
| `src/commands/system/misc.rs` | Convert 3 handlers to macros |
| `src/ui/pages/help_content.rs` | Clarify input/output format |
| `docs/MANUAL.md` | Document standard patterns |

## Testing

1. Test all boolean flags accept 0/1
2. Verify output format consistency
3. Test config persistence after changes
4. Verify help text accuracy
