# Additional Filter Types Plan

## Overview

Expand filter selection beyond SVF to include classic analog-style filters.

## Current State

### Existing Filter: SVF (State-Variable Filter)

**Parameter:** `FT` / `FILT.TYP` (0-3)
- 0: Lowpass
- 1: Highpass
- 2: Bandpass
- 3: Notch

### SVF Characteristics
- Clean, precise digital filter
- Simultaneous multimode output
- Moderate resonance character
- CPU efficient

## Implemented Filter Types

### Filter Selection: FT 0-13

| Type | Name | Character | Use Case |
|------|------|-----------|----------|
| **0** | SVF LP | Clean, precise digital | General lowpass |
| **1** | SVF HP | Clean, precise digital | General highpass |
| **2** | SVF BP | Clean, precise digital | Bandpass filtering |
| **3** | SVF NOTCH | Clean, precise digital | Notch filtering |
| **4** | MOOG | Warm, saturating | Bass, leads |
| **5** | RES LP | Simple, punchy | Drums, percussion |
| **6** | RES HP | Tight, clean | Hi-hats, filtering |
| **7** | DFM1 LP | Digital filter model LP | Aggressive lowpass |
| **8** | DFM1 HP | Digital filter model HP | Aggressive highpass |
| **9** | BMOOG LP | BMoog ladder lowpass | Deep bass |
| **10** | BMOOG HP | BMoog ladder highpass | Bright filtering |
| **11** | BMOOG BP | BMoog ladder bandpass | Resonant sweeps |
| **12** | SC LP | Switched-capacitor LP | Classic digital |
| **13** | SC HP | Switched-capacitor HP | Classic digital |

### Filter Characteristics

**SVF (State-Variable Filter) - Types 0-3**
- Clean, precise digital filter
- Simultaneous multimode output
- Moderate resonance character
- CPU efficient

**MoogFF (Moog Ladder Filter) - Type 4**
- 4-pole (24dB/octave) lowpass
- Self-oscillates at high resonance
- Built-in saturation/drive
- Classic analog warmth

**RLPF/RHPF (Resonant Filters) - Types 5-6**
- 2-pole (12dB/octave)
- Cleaner than Moog, different than SVF
- Very CPU efficient
- Good for drums/percussion

**DFM1 (Digital Filter Model) - Types 7-8**
- Aggressive digital filtering
- Unique character
- Good for modern electronic sounds

**BMoog (BMoog Ladder) - Types 9-11**
- Based on Moog ladder topology
- Multiple modes available
- Deep bass response

**SC (Switched-Capacitor) - Types 12-13**
- Classic digital filter emulation
- Vintage digital character

## Implementation

### Task 1: SynthDef Changes

**File:** `sc/monokit_server.scd`

Replace filter section (~lines 268-273):

```supercollider
// Filter cutoff calculation (unchanged)
filterCutoff = fcSmooth + ((fkSmooth / 16383) * primaryFreq)
    + (filterEnv * (feSmooth / 16383) * 5000)
    + (modBus * mf_f * 5000);
filterCutoff = filterCutoff.clip(20, 20000);

// Q calculation
var svfQ = ((fqSmooth / 16383) * 0.9 + 0.1);
var moogRes = (fqSmooth / 16383) * 4;  // Moog resonance 0-4
var rlpfRQ = 1 - ((fqSmooth / 16383) * 0.95);  // RLPF rq (inverted)

// Multi-filter selection
sig = Select.ar(ft.clip(0, 6).round, [
    // 0: SVF Lowpass
    SVF.ar(sig, filterCutoff, svfQ, 1, 0, 0, 0, 0),
    // 1: SVF Highpass
    SVF.ar(sig, filterCutoff, svfQ, 0, 1, 0, 0, 0),
    // 2: SVF Bandpass
    SVF.ar(sig, filterCutoff, svfQ, 0, 0, 1, 0, 0),
    // 3: SVF Notch
    SVF.ar(sig, filterCutoff, svfQ, 0, 0, 0, 1, 0),
    // 4: Moog Ladder LP
    MoogFF.ar(sig, filterCutoff, moogRes),
    // 5: Resonant LP
    RLPF.ar(sig, filterCutoff, rlpfRQ),
    // 6: Resonant HP
    RHPF.ar(sig, filterCutoff, rlpfRQ)
]);
```

### Rust Implementation

**File:** `src/commands/synth/filter.rs`

FT parameter range updated to 0-13:
```rust
define_mode_param!(handle_ft, "ft", 0, 13, "FT", "FILTER TYPE MUST BE 0-13", "FILTER TYPE", "Failed to parse filter type");
```

### Help System

**File:** `src/ui/pages/help_content.rs`

Filter help updated to show all 14 types with abbreviated names to comply with 46-character line limit:
```
# FILTER
  FILT.CUT / FC <HZ>      CUT (20-20K)
  FILT.RES / FQ <0-16383> RES
  FILT.TYP / FT <0-13>    TYPE
    0=SVF LP  1=SVF HP  2=SVF BP  3=NOTCH
    4=MOOG  5=RES LP  6=RES HP
    7=DFM1 LP  8=DFM1 HP
    9=BMOOG LP  10=BMOOG HP  11=BMOOG BP
    12=SC LP  13=SC HP
  FLEV.AMT / FE <0-16383> ENV AMT
  FLEV.DEC / FED <MS>     ENV DEC
  FILT.KEY / FK <0-16383> KEY TRACK
  ROUT.MC / MC <0-1>      MOD -> FILT CUT
  ROUT.MQ / MQ <0-1>      MOD -> FILT RES
```

### SynthDef Implementation

**File:** `sc/monokit_server.scd`

Filter selection expanded to support all 14 filter types using Select.ar with ft.clip(0, 13).round.

## Files Modified

| File | Status | Changes |
|------|--------|---------|
| `sc/monokit_server.scd` | COMPLETE | All 14 filter types implemented |
| `build_scripts/compile_synthdefs.scd` | COMPLETE | Compiled synthdefs updated |
| `src/commands/synth/filter.rs` | COMPLETE | FT range updated to 0-13 |
| `src/ui/pages/help_content.rs` | COMPLETE | All 14 filter types documented |
| `docs/v0.3.4_filter_types.md` | COMPLETE | Implementation spec updated |

## Testing Checklist

- [x] SVF modes work (0-3): LP, HP, BP, NOTCH
- [x] MOOG (4) has warm character, self-oscillates
- [x] RES LP (5) sounds different than SVF LP
- [x] RES HP (6) sounds different than SVF HP
- [x] DFM1 LP/HP (7-8) provide aggressive filtering
- [x] BMOOG LP/HP/BP (9-11) provide deep bass response
- [x] SC LP/HP (12-13) provide classic digital character
- [x] Resonance works across all types
- [x] Cutoff/envelope/tracking work with all types
- [x] Filter type changes are smooth

## Usage Examples

```
FT 0          # SVF lowpass (default)
FT 4          # Moog ladder filter
FC 2000       # Set cutoff to 2kHz
FQ 12000      # Increase resonance
FT 9          # Switch to BMoog lowpass
```

## Future Considerations

- Formant filter for vocal sounds
- Per-filter drive/saturation control
- Additional filter modes for existing types
