# Additional Filter Types Plan

## Overview

Expand filter selection beyond SVF to include classic analog-style filters.

## Current State

### Existing Filter: SVF (State-Variable Filter)

**Parameter:** `FT` / `FILT.TYP` (0-3)
- 0: Lowpass
- 1: Highpass
- 2: Bandpass
- 3: Notch

### SVF Characteristics
- Clean, precise digital filter
- Simultaneous multimode output
- Moderate resonance character
- CPU efficient

## Proposed Filter Types

### Recommended Additions

| Type | UGen | Character | Use Case |
|------|------|-----------|----------|
| **Moog Ladder** | `MoogFF` | Warm, saturating | Bass, leads |
| **Resonant LP** | `RLPF` | Simple, punchy | Drums, percussion |
| **Resonant HP** | `RHPF` | Tight, clean | Hi-hats, filtering |

### Filter Characteristics

**MoogFF (Moog Ladder Filter)**
- 4-pole (24dB/octave) lowpass
- Self-oscillates at high resonance
- Built-in saturation/drive
- Classic analog warmth
- Slightly higher CPU than SVF

**RLPF/RHPF (Resonant Filters)**
- 2-pole (12dB/octave)
- Cleaner than Moog, different than SVF
- Very CPU efficient
- Good for drums/percussion

## Design Decision: Parameter Approach

### Option A: Extend FT Range (Recommended)

Expand `ft` from 0-3 to 0-7:
```
0: SVF Lowpass
1: SVF Highpass
2: SVF Bandpass
3: SVF Notch
4: Moog Lowpass
5: RLPF (Resonant LP)
6: RHPF (Resonant HP)
7: (Reserved)
```

**Pros:** Single parameter, backward compatible
**Cons:** Moog has no HP/BP modes

### Option B: Separate Algorithm + Mode

New parameter `fa` (filter algorithm):
```
fa=0: SVF (ft selects LP/HP/BP/Notch)
fa=1: Moog (ft ignored, LP only)
fa=2: Resonant (ft selects LP/HP)
```

**Pros:** Cleaner separation
**Cons:** More parameters, complexity

## Implementation (Option A)

### Task 1: SynthDef Changes

**File:** `sc/monokit_server.scd`

Replace filter section (~lines 268-273):

```supercollider
// Filter cutoff calculation (unchanged)
filterCutoff = fcSmooth + ((fkSmooth / 16383) * primaryFreq)
    + (filterEnv * (feSmooth / 16383) * 5000)
    + (modBus * mf_f * 5000);
filterCutoff = filterCutoff.clip(20, 20000);

// Q calculation
var svfQ = ((fqSmooth / 16383) * 0.9 + 0.1);
var moogRes = (fqSmooth / 16383) * 4;  // Moog resonance 0-4
var rlpfRQ = 1 - ((fqSmooth / 16383) * 0.95);  // RLPF rq (inverted)

// Multi-filter selection
sig = Select.ar(ft.clip(0, 6).round, [
    // 0: SVF Lowpass
    SVF.ar(sig, filterCutoff, svfQ, 1, 0, 0, 0, 0),
    // 1: SVF Highpass
    SVF.ar(sig, filterCutoff, svfQ, 0, 1, 0, 0, 0),
    // 2: SVF Bandpass
    SVF.ar(sig, filterCutoff, svfQ, 0, 0, 1, 0, 0),
    // 3: SVF Notch
    SVF.ar(sig, filterCutoff, svfQ, 0, 0, 0, 1, 0),
    // 4: Moog Ladder LP
    MoogFF.ar(sig, filterCutoff, moogRes),
    // 5: Resonant LP
    RLPF.ar(sig, filterCutoff, rlpfRQ),
    // 6: Resonant HP
    RHPF.ar(sig, filterCutoff, rlpfRQ)
]);
```

### Task 2: Update Rust Validation

**File:** `src/commands/synth/filter.rs`

Update FT range from 0-3 to 0-6:
```rust
define_synth_param!(
    handle_ft, "ft", "FT", "FILTER TYPE",
    0, 6, |v| v as i32,  // Changed from 0-3
    "Failed to parse filter type"
);
```

### Task 3: Update Help System

**File:** `src/ui/pages/help_content.rs`

```
# FILTER
  FILT.CUT / FC <20-20000>  FILTER CUTOFF (HZ)
  FILT.RES / FQ <0-16383>   FILTER RESONANCE
  FILT.TYP / FT <0-6>       FILTER TYPE
                            0=SVF LP, 1=SVF HP
                            2=SVF BP, 3=SVF NOTCH
                            4=MOOG LP, 5=RES LP
                            6=RES HP
  FILT.KEY / FK <0-16383>   KEY TRACKING
```

### Task 4: Update Documentation

**File:** `docs/MANUAL.md`

Add filter type descriptions:
```markdown
### Filter Types

| Type | Sound | Best For |
|------|-------|----------|
| 0 SVF LP | Clean, precise | General use |
| 1 SVF HP | Clean removal | Clearing lows |
| 2 SVF BP | Focused | Resonant peaks |
| 3 SVF NOTCH | Phase-y | Removing freqs |
| 4 MOOG LP | Warm, fat | Bass, leads |
| 5 RES LP | Punchy | Drums, snares |
| 6 RES HP | Tight | Hi-hats |
```

### Task 5: Compile Updated SynthDef

**File:** `build_scripts/compile_synthdefs.scd`

Mirror changes from main SynthDef.

## Files to Modify

| File | Changes |
|------|---------|
| `sc/monokit_server.scd` | Add Moog, RLPF, RHPF |
| `src/commands/synth/filter.rs` | Update FT range |
| `src/ui/pages/help_content.rs` | Document types |
| `docs/MANUAL.md` | Add descriptions |
| `build_scripts/compile_synthdefs.scd` | Update compiled |
| `command_reference.md` | Update FT range |

## Testing

1. SVF modes still work (0-3)
2. Moog (4) has warm character, self-oscillates
3. RLPF (5) sounds different than SVF LP
4. RHPF (6) sounds different than SVF HP
5. Resonance works across all types
6. Cutoff/envelope/tracking work with all types
7. Quick filter type changes don't click

## Future Considerations

- DFM1 (digital filter model) as mode 7
- Formant filter for vocal sounds
- Comb filter (already have resonator)
- Per-filter drive/saturation control
